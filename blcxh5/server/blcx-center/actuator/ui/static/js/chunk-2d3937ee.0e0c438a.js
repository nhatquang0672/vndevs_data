(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d3937ee"],{1256:function(e,t,n){"use strict";n("4ed3")},"2af2":function(e,t,n){"use strict";n("3248")},3248:function(e,t,n){},"333d":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pagination-container",class:{hidden:e.hidden}},[n("el-pagination",e._b({attrs:{background:e.background,"current-page":e.currentPage,"page-size":e.pageSize,layout:e.layout,"page-sizes":e.pageSizes,total:e.total},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}},"el-pagination",e.$attrs,!1))],1)},s=[];n("a9e3");Math.easeInOutQuad=function(e,t,n,i){return e/=i/2,e<1?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)};var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function r(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function o(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function l(e,t,n){var i=o(),s=e-i,l=20,c=0;t="undefined"===typeof t?500:t;var u=function e(){c+=l;var o=Math.easeInOutQuad(c,i,s,t);r(o),c<t?a(e):n&&"function"===typeof n&&n()};u()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default:function(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get:function(){return this.page},set:function(e){this.$emit("update:page",e)}},pageSize:{get:function(){return this.limit},set:function(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange:function(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&l(0,800)},handleCurrentChange:function(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&l(0,800)}}},u=c,d=(n("5660"),n("2877")),p=Object(d["a"])(u,i,s,!1,null,"6af373ef",null);t["a"]=p.exports},"385b":function(e,t,n){},"3cbc":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pan-item",style:{zIndex:e.zIndex,height:e.height,width:e.width}},[n("div",{staticClass:"pan-info"},[n("div",{staticClass:"pan-info-roles-container"},[e._t("default")],2)]),n("div",{staticClass:"pan-thumb",style:{backgroundImage:"url("+e.image+")"}})])},s=[],a=(n("a9e3"),{name:"PanThumb",props:{image:{type:String,required:!0},zIndex:{type:Number,default:1},width:{type:String,default:"150px"},height:{type:String,default:"150px"}}}),r=a,o=(n("1256"),n("2877")),l=Object(o["a"])(r,i,s,!1,null,"799537af",null);t["a"]=l.exports},4315:function(e,t,n){},"4ed3":function(e,t,n){},5660:function(e,t,n){"use strict";n("7a30")},6085:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return u}));n("d3b7"),n("e9c4"),n("b64b"),n("159b");var i=n("4360"),s=n("5c96"),a=18e5,r="x-session";function o(){var e=i["a"].getters.lastActiveTime,t=(new Date).getTime(),n=t-e>a;return n&&s["MessageBox"].alert("会话过期,请重新登录","Confirm logout",{confirmButtonText:"重新登录",type:"warning",showClose:!1}).then((function(){i["a"].dispatch("user/resetToken").then((function(){location.reload()}))})),n}function l(){return new Promise((function(e,t){t("会话过期,请重新登录")}))}function c(e){e.headers[r]=JSON.stringify({id:i["a"].getters.id,time:i["a"].getters.time,token:i["a"].getters.token,roles:[]})}function u(){return JSON.stringify({id:i["a"].getters.id,time:i["a"].getters.time,token:i["a"].getters.token,roles:[]})}},"65ea":function(e,t,n){"use strict";n("4315")},6724:function(e,t,n){"use strict";n("8d41");var i="@@wavesContext";function s(e,t){function n(n){var i=Object.assign({},t.value),s=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},i),a=s.ele;if(a){a.style.position="relative",a.style.overflow="hidden";var r=a.getBoundingClientRect(),o=a.querySelector(".waves-ripple");switch(o?o.className="waves-ripple":(o=document.createElement("span"),o.className="waves-ripple",o.style.height=o.style.width=Math.max(r.width,r.height)+"px",a.appendChild(o)),s.type){case"center":o.style.top=r.height/2-o.offsetHeight/2+"px",o.style.left=r.width/2-o.offsetWidth/2+"px";break;default:o.style.top=(n.pageY-r.top-o.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",o.style.left=(n.pageX-r.left-o.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return o.style.backgroundColor=s.color,o.className="waves-ripple z-active",!1}}return e[i]?e[i].removeHandle=n:e[i]={removeHandle:n},n}var a={bind:function(e,t){e.addEventListener("click",s(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[i].removeHandle,!1),e.addEventListener("click",s(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[i].removeHandle,!1),e[i]=null,delete e[i]}},r=function(e){e.directive("waves",a)};window.Vue&&(window.waves=a,Vue.use(r)),a.install=r;t["a"]=a},"7a30":function(e,t,n){},"8d41":function(e,t,n){},9406:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dashboard-container"},[n(e.currentRole,{tag:"component"})],1)},s=[],a=n("5530"),r=(n("caad"),n("2532"),n("2f62")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dashboard-editor-container"},[n("div",{staticClass:"filter-container"},[n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:function(t){return e.getList()}}},[e._v("刷新")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.showNewServerDialog()}}},[e._v("新增")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-magic-stick"},on:{click:function(t){return e.selection("hotUpdate")}}},[e._v("热更")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-magic-stick"},on:{click:function(t){return e.selection("hotUpdate")}}},[e._v("版本更新")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-close"},on:{click:function(t){return e.selection("startup")}}},[e._v("启动")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"danger",icon:"el-icon-close"},on:{click:function(t){return e.selection("shutdown")}}},[e._v("关闭")]),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-close"},on:{click:function(t){return e.selection("restart")}}},[e._v("重启")]),n("el-select",{staticClass:"filter-item",staticStyle:{"margin-left":"10px",width:"100px"},attrs:{placeholder:"状态"},on:{change:e.changeStatus},model:{value:e.runType,callback:function(t){e.runType=t},expression:"runType"}},[n("el-option",{attrs:{label:"所有",value:1}}),n("el-option",{attrs:{label:"运行",value:2}}),n("el-option",{attrs:{label:"关闭",value:3}})],1),n("el-select",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{placeholder:"主机",multiple:""},on:{change:e.changeHost},model:{value:e.selectedHosts,callback:function(t){e.selectedHosts=t},expression:"selectedHosts"}},e._l(e.hosts,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1),n("el-select",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{placeholder:"版本",multiple:""},on:{change:e.changeVersion},model:{value:e.selectedVersions,callback:function(t){e.selectedVersions=t},expression:"selectedVersions"}},e._l(e.versions,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),n("el-table",{ref:"mainTable",staticStyle:{width:"100%"},attrs:{data:e.servers,stripe:""},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),n("el-table-column",{attrs:{align:"center",prop:"id",label:"ID"}}),n("el-table-column",{attrs:{align:"center",prop:"name",label:"名称"}}),n("el-table-column",{attrs:{align:"center",prop:"pid",label:"进程ID"}}),n("el-table-column",{attrs:{align:"center",prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[i.restartTime>0?n("el-tag",{attrs:{type:"warning"}},[e._v("重启中")]):i.shutdownTime>0?n("el-tag",{attrs:{type:"danger"}},[e._v("关闭中")]):i.pid>0?n("el-tag",{attrs:{type:"success"}},[e._v("运行")]):n("el-tag",{attrs:{type:"info"}},[e._v("关闭")])]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"600"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.selection("hotUpdate",[i])}}},[e._v("热更")]),n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.selection("hotUpdate",[i])}}},[e._v("版本更新")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selection("startup",[i])}}},[e._v("启动")]),n("el-button",{attrs:{type:"danger",loading:i.shutdownTime>0,disabled:i.pid>0&&i.shutdownTime>0},on:{click:function(t){return e.selection("shutdown",[i])}}},[e._v("关闭")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selection("restart",[i])}}},[e._v("重启")]),n("el-button",{attrs:{type:"warning",disabled:""}},[e._v("日志")])]}}])})],1),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){return e.$set(e.listQuery,"page",t)},"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},pagination:e.getList}}),n("el-dialog",{attrs:{title:"新增服务器",visible:e.newServerDialogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.newServerDialogVisible=t}}},[n("div",[n("el-form",{ref:"form",attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"版本"}},[n("el-select",{model:{value:e.newServerEdit.version,callback:function(t){e.$set(e.newServerEdit,"version",t)},expression:"newServerEdit.version"}},e._l(e.versions,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),n("el-form-item",{attrs:{label:"渠道"}},[n("el-select",{attrs:{disabled:null!=e.newServerEdit.host},on:{change:e.newServerChangeChannel},model:{value:e.newServerEdit.channel,callback:function(t){e.$set(e.newServerEdit,"channel",t)},expression:"newServerEdit.channel"}},e._l(e.channels,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),n("el-form-item",{attrs:{label:"JVM参数"}},[n("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"260px","margin-right":"5px","margin-left":"15px"},attrs:{"fetch-suggestions":e.querySearch},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(i.label))])]}}]),model:{value:e.javaOptions.Xms,callback:function(t){e.$set(e.javaOptions,"Xms",t)},expression:"javaOptions.Xms"}},[n("template",{slot:"prepend"},[e._v("Xms(启动内存)")])],2),e._v("M "),n("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"260px","margin-right":"5px","margin-left":"15px"},attrs:{"fetch-suggestions":e.querySearch},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(i.label))])]}}]),model:{value:e.javaOptions.Xmx,callback:function(t){e.$set(e.javaOptions,"Xmx",t)},expression:"javaOptions.Xmx"}},[n("template",{slot:"prepend"},[e._v("Xmx(最大内存)")])],2),e._v("M "),n("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"260px","margin-right":"5px","margin-left":"15px"},attrs:{"fetch-suggestions":e.querySearch},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(i.label))])]}}]),model:{value:e.javaOptions.Xmn,callback:function(t){e.$set(e.javaOptions,"Xmn",t)},expression:"javaOptions.Xmn"}},[n("template",{slot:"prepend"},[e._v("Xmn(新生代内存)")])],2),e._v("M "),n("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"260px","margin-right":"5px","margin-left":"15px"},attrs:{"fetch-suggestions":e.querySearch},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(i.label))])]}}]),model:{value:e.javaOptions.Xss,callback:function(t){e.$set(e.javaOptions,"Xss",t)},expression:"javaOptions.Xss"}},[n("template",{slot:"prepend"},[e._v("Xss(每线程内存)")])],2),e._v("M "),n("div",[e._v("（以上值为0时为不设置）")])],1)],1),n("el-table",{ref:"newServerHostTable",staticStyle:{width:"100%","margin-top":"50px"},attrs:{data:e.newServerHosts}},[n("el-table-column",{attrs:{align:"center",prop:"selected",width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("el-checkbox",{on:{change:function(t){return e.newServerSelectHost(i)}},model:{value:i.selected,callback:function(t){e.$set(i,"selected",t)},expression:"row.selected"}})]}}])}),n("el-table-column",{attrs:{align:"center",prop:"host",label:"主机"}}),n("el-table-column",{attrs:{align:"center",prop:"serverNumber",label:"已有服务数量"}}),n("el-table-column",{attrs:{align:"center",prop:"residueMemory",label:"剩余内存"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(n.residueMemory)+"M")]}}])}),n("el-table-column",{attrs:{align:"center",prop:"memory",label:"内存占用"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(n.useMemory)+"M / "+e._s(n.totalMemory)+"M")]}}])})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.newServerDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.newServerSubmit}},[e._v("确 定")])],1)]),n("el-dialog",{attrs:{title:"服务器",visible:e.serverDialogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.serverDialogVisible=t}}},[n("div",[n("el-form",{ref:"form",attrs:{"label-width":"80px"}},[n("el-form-item",{attrs:{label:"ID"}}),n("el-form-item",{attrs:{label:"父ID"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",disabled:e.submitButtonDisabled},on:{click:e.selectionAction}},[e._v("确 定")])],1)]),n("el-dialog",{attrs:{title:e.operateTypeNames[e.operateType],visible:e.operateDialogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.operateDialogVisible=t}}},[n("el-alert",{attrs:{title:e.operateText,type:"warning",closable:!1}}),n("div",{staticStyle:{"margin-top":"25px"}},e._l(e.selections,(function(t){return n("el-button",{key:t.id,attrs:{type:t.pid>0?"primary":"info",loading:t.shutdownTime>0||t.restartTime>0,plain:""}},[e._v(e._s(t.id))])})),1),"hotUpdate"===e.operateType?n("div",{staticStyle:{"margin-top":"25px"}},[n("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.hotUpdateUrl(),"file-list":e.uploadFileList,headers:e.headers,"on-change":e.uploadHandleChange,"on-success":e.uploadHandleSuccess,"auto-upload":!1,multiple:"",drag:""}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),n("em",[e._v("点击上传")])])])],1):e._e(),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",disabled:e.submitButtonDisabled},on:{click:e.selectionAction}},[e._v("确 定")])],1)],1),n("el-dialog",{attrs:{title:"运行日志",visible:e.logDialogVisible,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.logDialogVisible=t}}},[n("div",[n("ul",{staticClass:"infinite-list",staticStyle:{overflow:"auto",height:"500px"},attrs:{id:"logUL"}},e._l(e.runInfo.logs,(function(t,i){return n("li",{key:i,staticClass:"infinite-list-item"},[e._v(e._s(t))])})),0)]),n("div",[1===e.runInfo.status?n("span",{staticStyle:{"font-size":"22px","font-weight":"500"}},[n("i",{staticClass:"el-icon-loading"})]):2===e.runInfo.status?n("el-alert",{attrs:{title:"执行成功",type:"success","show-icon":"",closable:!1}}):-1===e.runInfo.status?n("el-alert",{attrs:{title:"执行错误",type:"error","show-icon":"",closable:!1}}):e._e()],1)])],1)},l=[],c=(n("d3b7"),n("159b"),n("498a"),n("4e82"),n("b0c0"),n("a434"),n("e9c4"),n("6724")),u=n("e0ac"),d=n("6085"),p=n("ed08"),h=n("333d"),f={name:"DashboardAdmin",directives:{waves:c["a"]},components:{Pagination:h["a"]},data:function(){return{runType:1,servers:[],allServers:[],server:null,selections:[],hosts:[],versions:[],channels:[],selectedHosts:[],selectedVersions:[],shutdownTimeout:18e4,operateType:"",operateText:"",operateTypeNames:{hotUpdate:"热更",shutdown:"关闭"},serverDialogVisible:!1,newServerDialogVisible:!1,operateDialogVisible:!1,submitButtonDisabled:!1,logDialogVisible:!1,headers:{},uploadFileList:[],uploadSuccessFileMap:{},total:0,listQuery:{limit:10,page:1,isDisuse:!1},newServerEdit:{channel:null,version:null},newServerHosts:[],defaultJavaOptions:{Xmx:"0",Xms:"0",Xmn:"0",Xss:"0"},javaOptions:{Xmx:"0",Xms:"0",Xmn:"0",Xss:"0"},memorySelections:[],runInfo:{id:null,status:0,logs:[],logIndex:0}}},created:function(){this.init(),this.getList()},methods:{init:function(){var e=this;this.memorySelections=[];for(var t=1;t<=10;t++)this.memorySelections.push({value:1024*t+"",label:1024*t+" ("+t+"G)"});Object(u["g"])("host/list").then((function(t){var n=[];t.forEach((function(e){n.push(e.host)})),e.hosts=n})),Object(u["g"])("version/pageList",{limit:200,page:1}).then((function(t){var n=[];t.list.forEach((function(e){n.push(e.version)})),e.versions=n})),Object(u["g"])("channel/list").then((function(t){e.channels=t})),Object(u["g"])("configs",["serverRootPath","serverFormat","isIpWhiteList","ipWhiteList","javaOptions"]).then((function(t){t.forEach((function(t){"javaOptions"===t.key&&(e.defaultJavaOptions.Xmx=t.value.Xmx?t.value.Xmx+"":"0",e.defaultJavaOptions.Xms=t.value.Xms?t.value.Xms+"":"0",e.defaultJavaOptions.Xmn=t.value.Xmn?t.value.Xmn+"":"0",e.defaultJavaOptions.Xss=t.value.Xss?t.value.Xss+"":"0")}))}))},getList:function(){var e=this;this.selectedHosts=[],this.selectedVersions=[],Object(u["g"])("server/pageList",this.listQuery).then((function(t){e.total=t.total;var n=[];t.list.forEach((function(e){n.push(e)})),e.servers=n,e.allServers=n,e.changeStatus()}))},changeStatus:function(){var e=[];1===this.runType?this.allServers.forEach((function(t){e.push(t)})):2===this.runType?this.allServers.forEach((function(t){t.pid>0&&e.push(t)})):3===this.runType&&this.allServers.forEach((function(t){0===t.pid&&e.push(t)})),this.servers=e},newServerSubmit:function(){var e=this;if(null!=this.newServerEdit.version&&0!==this.newServerEdit.version.trim().length)if(null!=this.newServerEdit.channel&&0!==this.newServerEdit.channel.trim().length){this.newServerEdit.channel=this.newServerEdit.channel.trim(),this.newServerEdit.version=this.newServerEdit.version.trim();for(var t=null,n=0,i=this.newServerHosts.length;n<i;n++)if(this.newServerHosts[n].selected){t=this.newServerHosts[n];break}if(t){var s={channel:this.newServerEdit.channel,version:this.newServerEdit.version,host:t.host,Xmx:this.javaOptions.Xmx,Xms:this.javaOptions.Xms,Xmn:this.javaOptions.Xmn,Xss:this.javaOptions.Xms};Object(u["g"])("server/add",s).then((function(t){e.runInfo.id=t,e.runInfo.status=0,e.runInfo.logs=[],e.runInfo.logIndex=0,e.logDialogVisible=!0,e.getLog()}))}else this.$message.warning("请选择 主机")}else this.$message.warning("请输入 渠道");else this.$message.warning("请输入 版本")},getLog:function(){var e=this;console.log("获取日志"),this.runInfo.id&&Object(u["g"])("deployment/log",{id:this.runInfo.id,index:this.runInfo.logIndex}).then((function(t){var n=t.index>e.runInfo.logIndex;if(e.runInfo.status=t.status,e.runInfo.logIndex=t.index,e.runInfo.status=t.status,t.list.forEach((function(t){e.runInfo.logs.push(t)})),n){var i=document.getElementById("logUL");i.scrollTop=i.scrollHeight}if(e.logDialogVisible&&1===e.runInfo.status){var s=e;setTimeout((function(){s.getLog()}),3e3)}}))},showNewServerDialog:function(){this.javaOptions=Object(p["c"])(this.defaultJavaOptions),this.newServerEdit.channel=null,this.newServerEdit.version=null,this.newServerHosts=[],this.newServerDialogVisible=!0},newServerChangeChannel:function(){var e=this;this.newServerHosts=[],this.newServerEdit.channel&&Object(u["g"])("host/channelList",this.newServerEdit.channel).then((function(t){t&&(t.forEach((function(e){e.selected=!1,e.residueMemory=e.totalMemory-e.useMemory})),t.sort((function(e,t){return e.residueMemory===t.residueMemory?0:e.residueMemory>t.residueMemory?-1:1})),e.newServerHosts=t)}))},newServerSelectHost:function(e){this.newServerHosts.forEach((function(e){e.selected=!1})),e.selected=!0},changeHost:function(){var e=this;if(0===this.selectedHosts.length)this.servers=this.allServers;else{var t=[];this.allServers.forEach((function(n){if(n.host)for(var i=0,s=e.selectedHosts.length;i<s;i++)if(n.host===e.selectedHosts[i]){t.push(n);break}})),this.servers=t}},changeVersion:function(){var e=this;if(0===this.selectedVersions.length)this.servers=this.allServers;else{var t=[];this.allServers.forEach((function(n){if(n.version)for(var i=0,s=e.selectedVersions.length;i<s;i++)if(n.version===e.selectedVersions[i]){t.push(n);break}})),this.servers=t}},toggleSelection:function(e){var t=this;this.$refs.mainTable.clearSelection(),e&&e.forEach((function(e){t.$refs.mainTable.toggleRowSelection(e)}))},handleSelectionChange:function(e){this.selections=e},selection:function(e,t){if(t)this.toggleSelection(t);else if(0===this.selections.length)return void this.$message.warning("请选择 操作项");"hotUpdate"===e?(this.operateText="确实要热更新下拉服务？",this.uploadFileList=[]):"startup"===e?this.operateText="确实要启动下拉服务？":"shutdown"===e?this.operateText="确实要关闭下拉服务？":"restart"===e&&(this.operateText="确实要重启下拉服务？"),this.operateType=e,this.operateDialogVisible=!0,this.submitButtonDisabled=!1},selectionAction:function(){0!==this.selections.length?"startup"===this.operateType||"shutdown"===this.operateType||"restart"===this.operateType?this.operateServerAction():"hotUpdate"===this.operateType&&this.hotUpdateAction():this.$message.warning("请选择 操作项")},operateServerAction:function(){var e=this,t=-1;"startup"===this.operateType?t=0:"shutdown"===this.operateType?t=1:"restart"===this.operateType&&(t=2);for(var n=[],i=0;i<this.selections.length;i++)n.push(this.selections[i].id);var s={ids:n,operateType:t};Object(u["g"])("server/operate",s).then((function(t){e.isShutdown(),e.operateDialogVisible=!1}))},isShutdown:function(){var e=this;console.log("检查服务器是否关闭");var t=[],n=[],i=Date.now();if(this.servers.forEach((function(s){var a=s.shutdownTime;a&&(a+e.shutdownTimeout>i?t.push(s.id):n.push(s.name))})),n.length>0){var s=null;n.forEach((function(e){s?s+=",["+e+"]":s="["+e+"]"})),this.$message.warning("服务器"+s+"关闭超时，请确认状态")}t.length>0&&this.shutdownStatus(t)},shutdownStatus:function(e){var t=this;Object(u["g"])("servers",e).then((function(e){var n=e.list,i=!1;if(n.forEach((function(e){if(0===e.pid){for(var n,s=0,a=t.servers.length;s<a;s++)if(n=t.servers[s],e.id===n.id){n.pid=0,n.shutdownTime=0,t.servers.splice(s,1,n);break}}else i=!0})),i){var s=t;setTimeout((function(){s.isShutdown()}),3e3)}}))},hotUpdateUrl:function(){return Object(u["d"])()},uploadHandleChange:function(e,t){return this.uploadFileList=t,!0},uploadHandleSuccess:function(e,t,n){this.uploadSuccessFileMap[t.name]=e.content},hotUpdateAction:function(){if(0===this.uploadFileList.length)return this.$message.error("请选取上传文件"),!1;this.$confirm("是否更新对应版本库 ?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){})),this.headers["x-session"]=Object(d["a"])();for(var e=[],t=0;t<this.selections.length;t++)e.push(this.selections[t].id);this.headers["x-upload-param"]=JSON.stringify({id:e}),this.submitButtonDisabled=!0,this.upLoadSuccessFileMap={},this.$refs.upload.submit()},memoryCompute:function(){this.memoryNumber=1024*(this.memoryIndex?this.memoryIndex:0)},querySearch:function(e,t){t(this.memorySelections)}}},v=f,m=(n("65ea"),n("2877")),g=Object(m["a"])(v,o,l,!1,null,"1a1f86fe",null),b=g.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dashboard-editor-container"},[n("div",{staticClass:" clearfix"},[n("pan-thumb",{staticStyle:{float:"left"},attrs:{image:e.avatar}},[e._v(" Your roles: "),e._l(e.roles,(function(t){return n("span",{key:t,staticClass:"pan-info-roles"},[e._v(e._s(t))])}))],2),n("github-corner",{staticStyle:{position:"absolute",top:"0px",border:"0",right:"0"}}),n("div",{staticClass:"info-container"},[n("span",{staticClass:"display_name"},[e._v(e._s(e.name))]),n("span",{staticStyle:{"font-size":"20px","padding-top":"20px",display:"inline-block"}},[e._v("Editor's Dashboard")])])],1),n("div",[n("img",{staticClass:"emptyGif",attrs:{src:e.emptyGif}})])])},w=[],S=n("3cbc"),x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"github-corner",attrs:{href:"https://github.com/PanJiaChen/vue-element-admin",target:"_blank","aria-label":"View source on Github"}},[n("svg",{staticStyle:{fill:"#40c9c6",color:"#fff"},attrs:{width:"80",height:"80",viewBox:"0 0 250 250","aria-hidden":"true"}},[n("path",{attrs:{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}}),n("path",{staticClass:"octo-arm",staticStyle:{"transform-origin":"130px 106px"},attrs:{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor"}}),n("path",{staticClass:"octo-body",attrs:{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor"}})])])},_=[],C=(n("2af2"),{}),k=Object(m["a"])(C,x,_,!1,null,"09fe1acc",null),O=k.exports,T={name:"DashboardEditor",components:{PanThumb:S["a"],GithubCorner:O},data:function(){return{emptyGif:"https://wpimg.wallstcn.com/0e03b7da-db9e-4819-ba10-9016ddfdaed3"}},computed:Object(a["a"])({},Object(r["b"])(["name","avatar","roles"]))},E=T,j=(n("cb89"),Object(m["a"])(E,y,w,!1,null,"e3426062",null)),D=j.exports,X={name:"Dashboard",components:{adminDashboard:b,editorDashboard:D},data:function(){return{currentRole:"adminDashboard"}},computed:Object(a["a"])({},Object(r["b"])(["roles"])),created:function(){this.roles.includes("admin")||(this.currentRole="editorDashboard")}},U=X,I=Object(m["a"])(U,i,s,!1,null,null,null);t["default"]=I.exports},cb89:function(e,t,n){"use strict";n("385b")},e0ac:function(e,t,n){"use strict";n.d(t,"g",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return m}));n("d3b7");var i=n("bc3a"),s=n.n(i),a=n("5c96"),r=n("4360"),o=n("5f87"),l=n("6085"),c=s.a.create({baseURL:"http://127.0.0.1:9503/actuator/",timeout:5e3});function u(e,t){return Object(l["b"])()?Object(l["d"])():new Promise((function(n,i){c({url:e,method:"POST",data:t}).then((function(e){r["a"].dispatch("user/active",r["a"].getters.token),n(e)})).catch((function(e){i(e)}))}))}function d(){return"http://127.0.0.1:9503/actuator/hotUpdate/upload"}function p(){return"http://127.0.0.1:9503/actuator/version/upload"}function h(){return"http://127.0.0.1:9503/actuator/resource/version"}function f(){return"http://127.0.0.1:9503/actuator/deployment/templateUpload"}function v(){return"http://127.0.0.1:9503/actuator/resource/deployment"}function m(){return"http://127.0.0.1:9503/actuator/client/upload"}c.interceptors.request.use((function(e){return r["a"].getters.token&&(e.headers["X-Token"]=Object(o["a"])()),Object(l["c"])(e),e}),(function(e){return console.log(e),Promise.reject(e)})),c.interceptors.response.use((function(e){var t=e.data;return t.result||null===t.content?t.content:("string"===typeof t&&(t=JSON.parse(t)),Object(a["Message"])({message:t.content||"Error",type:"error",duration:5e3}),Promise.reject(new Error(t.content||"Error")))}),(function(e){return console.log("err"+e),Object(a["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)}))},e9c4:function(e,t,n){var i=n("23e7"),s=n("d066"),a=n("d039"),r=s("JSON","stringify"),o=/[\uD800-\uDFFF]/g,l=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(e,t,n){var i=n.charAt(t-1),s=n.charAt(t+1);return l.test(e)&&!c.test(s)||c.test(e)&&!l.test(i)?"\\u"+e.charCodeAt(0).toString(16):e},d=a((function(){return'"\\udf06\\ud834"'!==r("\udf06\ud834")||'"\\udead"'!==r("\udead")}));r&&i({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,n){var i=r.apply(null,arguments);return"string"==typeof i?i.replace(o,u):i}})}}]);