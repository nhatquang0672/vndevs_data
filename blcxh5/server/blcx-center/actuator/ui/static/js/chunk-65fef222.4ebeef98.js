(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-65fef222"],{2400:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"app-container",staticStyle:{"margin-left":"100px"}},[n("el-select",{staticStyle:{"margin-top":"50px",width:"380px"},attrs:{placeholder:"请选择"},on:{change:t.clearFiles},model:{value:t.path,callback:function(e){t.path=e},expression:"path"}},t._l(t.paths,(function(e){return n("el-option",{key:e.path,attrs:{label:e.description,value:e.path}},[n("span",{staticStyle:{float:"left"}},[t._v(t._s(e.description))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.path))])])})),1),n("el-button",{staticStyle:{"margin-left":"50px"},attrs:{type:"primary",icon:"el-icon-plus",plain:""},on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("新增目录")]),n("el-button",{staticStyle:{"margin-left":"50px"},attrs:{type:"primary",icon:"el-icon-files",plain:""},on:{click:t.getClientFiles}},[t._v("未解压文件")]),t.path?n("div",{staticStyle:{"margin-top":"10px"}},[n("el-link",{attrs:{type:"danger"}},[t._v(t._s(t.getPathItemTips(t.path)))])],1):t._e(),n("div",{staticStyle:{"margin-top":"25px"}},[n("el-upload",{ref:"upload",staticClass:"upload",attrs:{drag:"",action:t.getUpdateURL(),"on-success":t.handleSuccess,"on-error":t.handleError,"on-change":t.onFileChange,"file-list":t.fileList,headers:t.headers,"auto-upload":!1}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),n("em",[t._v("点击上传")])]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传zip文件，且不超过1000M")])]),n("el-button",{ref:"submitButton",staticStyle:{"margin-left":"10px"},attrs:{size:"medium",type:"success"},on:{click:t.submitUpload}},[t._v("上传")]),n("el-switch",{staticStyle:{"margin-left":"50px"},attrs:{"active-text":"立刻解压ZIP文件","inactive-text":""},model:{value:t.unzip,callback:function(e){t.unzip=e},expression:"unzip"}})],1),n("div",{staticStyle:{"margin-top":"10px"}},[t._v(" 注意：CDN当日剩余的可刷新的目录数量"),n("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.cndInfo.RefreshDirRemain))]),t._v("，每天允许最大刷新次数"),n("el-tag",{attrs:{type:"danger"}},[t._v(t._s(t.cndInfo.RefreshDirQuota))]),t._v("。每次解压消耗"),n("el-tag",{attrs:{type:"danger"}},[t._v("2")]),t._v("次目录刷新 ")],1),n("div",[t._v(" 如果快用完次数，CDN会刷新失败，请联系云服务商增加刷新次数 ")])],1),n("el-dialog",{attrs:{title:"新增目录",visible:t.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("el-form",{attrs:{model:t.item}},[n("el-form-item",{attrs:{label:"目录","label-width":"120px"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:t.item.path,callback:function(e){t.$set(t.item,"path",e)},expression:"item.path"}})],1),n("el-form-item",{attrs:{label:"名称","label-width":"120px"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:t.item.description,callback:function(e){t.$set(t.item,"description",e)},expression:"item.description"}})],1),n("el-form-item",{attrs:{label:"文件匹配","label-width":"120px"}},[n("el-input",{attrs:{placeholder:"多个匹配以逗号分隔",autocomplete:"off"},model:{value:t.item.patterns,callback:function(e){t.$set(t.item,"patterns",e)},expression:"item.patterns"}})],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.addPath}},[t._v("确 定")])],1)],1),n("el-dialog",{attrs:{title:"未解压文件",visible:t.dialogFormVisible2,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogFormVisible2=e}}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.clientFiles,stripe:""}},[n("el-table-column",{attrs:{align:"center",prop:"file",label:"文件"}}),n("el-table-column",{attrs:{align:"center",prop:"time",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v(t._s(t.showTime(n.time)))]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"500"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.clientFileAction(i.file,1)}}},[t._v("解压")]),n("el-button",{attrs:{type:"warning"},on:{click:function(e){return t.clientFileAction(i.file,2)}}},[t._v("删除")])]}}])})],1)],1)],1)},r=[],a=(n("e9c4"),n("a4d3"),n("e01a"),n("2ca0"),n("b0c0"),n("e0ac")),o=n("6085"),s=n("ed08"),l={components:{},data:function(){return{path:null,paths:[],unzip:!1,headers:{},fileList:[],clientFiles:[],item:{path:"xs/app/xxx",description:null,patterns:null},dialogFormVisible:!1,dialogFormVisible2:!1,cndInfo:{RefreshDirRemain:0,RefreshDirQuota:0}}},created:function(){this.init()},methods:{init:function(){this.headers["x-session"]=Object(o["a"])(),this.getPaths(),this.getCdnInf()},getCdnInf:function(){var t=this;Object(a["g"])("cnd/info").then((function(e){var n=JSON.parse(e);t.cndInfo.RefreshDirRemain=n.RefreshDirRemain,t.cndInfo.RefreshDirQuota=n.RefreshDirQuota}))},getPathItem:function(t){for(var e=0,n=this.paths.length;e<n;e++)if(this.paths[e].path===t)return this.paths[e];return null},getPathItemTips:function(t){console.log("path = "+t);for(var e=null,n=0,i=this.paths.length;n<i;n++)this.paths[n].path===t&&(e=this.paths[n]);return console.log("pathItem = ",e),e&&e.patterns&&e.patterns.length>0?"上传文件必须以"+JSON.stringify(e.patterns)+"开头":""},getPaths:function(){var t=this;Object(a["g"])("client/pathList",{}).then((function(e){t.paths=e}))},clearFiles:function(){this.$refs.upload.clearFiles(),this.fileList=[]},onFileChange:function(t,e){this.fileList.push(t)},addPath:function(){var t=this;null!=this.item.path&&0!==this.item.path.length?null!=this.item.description&&0!==this.item.description.length?(this.item.patterns=this.item.patterns?this.item.patterns:"",this.dialogFormVisible=!1,Object(a["g"])("client/pathAdd",this.item).then((function(e){t.$message.success("更新目录成功!"),t.getPaths()}))):this.$message.error("请输入 名称"):this.$message.error("请选输入 目录")},getUpdateURL:function(){return Object(a["a"])()},submitUpload:function(){var t=this,e=this.getPathItem(this.path);if(e&&e.patterns&&e.patterns.length>0)for(var n=0,i=this.fileList.length;n<i;n++){for(var r=!1,a=0,s=e.patterns.length;a<s;a++)if(r=this.fileList[n].name.startsWith(e.patterns[a]),r)break;if(!r)return void this.$message.error("文件名称不合规定,上传文件必须以"+JSON.stringify(e.patterns)+"开头")}this.path?null!=this.fileList&&0!==this.fileList.length?this.$confirm("确定更新目录【"+this.path+"】?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.headers["x-path"]=t.path,t.headers["unzip"]=t.unzip?"1":"0",t.headers["x-session"]=Object(o["a"])(),t.$refs.upload.submit()})).catch((function(){})):this.$message.error("请加入上传文件"):this.$message.error("请选 更新目录")},tabClick:function(t,e){this.currentIndex=t.index},handleSuccess:function(t){this.unzip=!1;var e=this;setTimeout((function(){e.clearFiles()}),1e3),t.result?this.$alert("操作成功","操作成功",{confirmButtonText:"确定"}):this.$message.error(t.content),this.getCdnInf()},handleError:function(){this.$alert("操作失败","操作失败",{confirmButtonText:"确定"}),this.clearFiles()},getClientFiles:function(){var t=this;Object(a["g"])("client/fileList").then((function(e){t.clientFiles=e,t.dialogFormVisible2=!0}))},clientFileAction:function(t,e){var n=this;this.$confirm(1===e?"解压文件["+t+"]":"删除文件["+t+"]","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:1===e?"warning":"error"}).then((function(){Object(a["g"])("client/fileAction",{action:e,file:t}).then((function(t){n.getClientFiles(),n.getCdnInf()}))}))},showTime:function(t){return Object(s["f"])(t)}}},c=l,u=n("2877"),p=Object(u["a"])(c,i,r,!1,null,null,null);e["default"]=p.exports},6085:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"d",(function(){return l})),n.d(e,"c",(function(){return c})),n.d(e,"a",(function(){return u}));n("d3b7"),n("e9c4"),n("b64b"),n("159b");var i=n("4360"),r=n("5c96"),a=18e5,o="x-session";function s(){var t=i["a"].getters.lastActiveTime,e=(new Date).getTime(),n=e-t>a;return n&&r["MessageBox"].alert("会话过期,请重新登录","Confirm logout",{confirmButtonText:"重新登录",type:"warning",showClose:!1}).then((function(){i["a"].dispatch("user/resetToken").then((function(){location.reload()}))})),n}function l(){return new Promise((function(t,e){e("会话过期,请重新登录")}))}function c(t){t.headers[o]=JSON.stringify({id:i["a"].getters.id,time:i["a"].getters.time,token:i["a"].getters.token,roles:[]})}function u(){return JSON.stringify({id:i["a"].getters.id,time:i["a"].getters.time,token:i["a"].getters.token,roles:[]})}},e0ac:function(t,e,n){"use strict";n.d(e,"g",(function(){return u})),n.d(e,"d",(function(){return p})),n.d(e,"f",(function(){return f})),n.d(e,"e",(function(){return h})),n.d(e,"c",(function(){return d})),n.d(e,"b",(function(){return m})),n.d(e,"a",(function(){return g}));n("d3b7");var i=n("bc3a"),r=n.n(i),a=n("5c96"),o=n("4360"),s=n("5f87"),l=n("6085"),c=r.a.create({baseURL:"http://127.0.0.1:9503/actuator/",timeout:5e3});function u(t,e){return Object(l["b"])()?Object(l["d"])():new Promise((function(n,i){c({url:t,method:"POST",data:e}).then((function(t){o["a"].dispatch("user/active",o["a"].getters.token),n(t)})).catch((function(t){i(t)}))}))}function p(){return"http://127.0.0.1:9503/actuator/hotUpdate/upload"}function f(){return"http://127.0.0.1:9503/actuator/version/upload"}function h(){return"http://127.0.0.1:9503/actuator/resource/version"}function d(){return"http://127.0.0.1:9503/actuator/deployment/templateUpload"}function m(){return"http://127.0.0.1:9503/actuator/resource/deployment"}function g(){return"http://127.0.0.1:9503/actuator/client/upload"}c.interceptors.request.use((function(t){return o["a"].getters.token&&(t.headers["X-Token"]=Object(s["a"])()),Object(l["c"])(t),t}),(function(t){return console.log(t),Promise.reject(t)})),c.interceptors.response.use((function(t){var e=t.data;return e.result||null===e.content?e.content:("string"===typeof e&&(e=JSON.parse(e)),Object(a["Message"])({message:e.content||"Error",type:"error",duration:5e3}),Promise.reject(new Error(e.content||"Error")))}),(function(t){return console.log("err"+t),Object(a["Message"])({message:t.message,type:"error",duration:5e3}),Promise.reject(t)}))},e9c4:function(t,e,n){var i=n("23e7"),r=n("d066"),a=n("d039"),o=r("JSON","stringify"),s=/[\uD800-\uDFFF]/g,l=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(t,e,n){var i=n.charAt(e-1),r=n.charAt(e+1);return l.test(t)&&!c.test(r)||c.test(t)&&!l.test(i)?"\\u"+t.charCodeAt(0).toString(16):t},p=a((function(){return'"\\udf06\\ud834"'!==o("\udf06\ud834")||'"\\udead"'!==o("\udead")}));o&&i({target:"JSON",stat:!0,forced:p},{stringify:function(t,e,n){var i=o.apply(null,arguments);return"string"==typeof i?i.replace(s,u):i}})}}]);