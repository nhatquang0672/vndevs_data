<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>做个游戏</title>
    </head>
<body >



<div class="navbar"  align="center"  >
        <span style="color: #fff;font-size: 16px;">当前账号：<%=user.account%></span>
</div>


<div class="divleft">
        <div class="left_wrap">
                <div class="left_nav">
                    <ul>
                        <li class="left_nav-list">
                            <%for (const key in menu) {%>
                            <h2><div></div>
                                <%=key%>
                                <i></i>
                            </h2>
                            <div class="left_hide">
                                <%for (const key2 in menu[key]) {%>
                                    <h5>
                                    <form action="<%=key2%>/<%=token%>" method="POST">
                                        <button  class="button" type="submit" ><%=menu[key][key2].name%></button>
                                    </form>
                                    </h5>
                                <%}%>
                            </div>
                            <%}%>
                        </li>
                        
                        
                    </ul>
                </div>
            </div>
            <script>
               
                var aList = document.querySelectorAll('.left_nav-list h2');    //依次获取需要h2，.hide,i标签
                
                var aHide = document.querySelectorAll('.left_hide');
                var oIcon = document.querySelectorAll('.left_nav-list i');
                var lastIndex = 0;    //自定义变量监控点击后的下标
                for(var i=0;i<aList.length;i++){
                   aList[i].index = i;  //自定义属性保存下标
                   aList[i].onclick = function() {
                       //判断是否二次点击同一栏
                       if(aHide[this.index].style.height == '0px' ){
                           //设置当前样式
                           aHide[this.index].style.height = "100%";
                           aList[this.index].className = 'on';            //点击后为h2添加class = 'on'
                           oIcon[this.index].className = 'on';
                       }else{
                           aHide[this.index].style.height = '0';
                           aList[this.index].className = '';
                           oIcon[this.index].className = '';
                       }
                       lastIndex = this.index; // 保存当前下标
                   }
                }
            </script>
        </div>
<div style="display: none">
        <input  id="win" name="win" value="<%=win%>">
</div>
<div style="display: none">
    <input  id="addOnclick" name="addOnclick" >
</div>
<div class="divright" >
        <table border="0" cellspacing="0" cellpadding="0" align="center">
                <tr>
                  <td align="center" class="biaoti" height="60">角色信息展示</td>
                </tr>
                <tr>
                </tr>
        </table>

        <table border="0" cellspacing="1" cellpadding="4" bgcolor="#cccccc" class="tabtop13" align="center">
                <tr>
                <form action="/s_player/<%=token%>" method="POST">
                    <div>
                        uuid:<input  id="uuid" name="uuid" value="">
                        <button   type="submit" >查询</button>
                    </div>
                </form>
                </tr>
                <tr>
                </tr>
        </table>



        <table border="0" cellspacing="1" cellpadding="4" bgcolor="#cccccc" class="tabtop13" align="center">
            <%for (let index = 0; index < data.length; index+=3) {%>
            <tr>
                <% if(data[index] != null) {%>
                    <td style="width: 8%;">
                        <form action="/s_player/editSave/<%=token%>/<%=win.uuid%>/<%=data[index].key1%>/<%=data[index].key2%>" method="POST" onsubmit="return fileSubmit(this)">
                            <div><span style="color: red;">标题：</span><%=data[index].desc%></div>
                            <div><span style="color: red;">存储一级key：</span><%=data[index].key1%></div>
                            <div><span style="color: red;">存储二级key：</span><%=data[index].key2%></div>
                            <div><span style="color: red;">存储内容：</span></div>
                            <textarea style="width: 100%;height: 120px;" name="info" id="<%=data[index].key2%>" ><%=data[index].info%></textarea>
                            <button  class="buttonTableUpdate" type="submit" >更新</button>
                            <a  class="buttonTableLook" onclick = "openDialog('<%=data[index].key2%>','<%=data[index].info%>')">可视化</a>
                        </form>
                    </td>
                <%}%>
                <% if(data[index+1] != null) {%>
                    <td style="width: 8%;">
                            <form action="/s_player/editSave/<%=token%>/<%=win.uuid%>/<%=data[index+1].key1%>/<%=data[index+1].key2%>" method="POST" onsubmit="return fileSubmit(this)">
                                <div><span style="color: red;">标题：</span><%=data[index+1].desc%></div>
                                <div><span style="color: red;">存储一级key：</span><%=data[index+1].key1%></div>
                                <div><span style="color: red;">存储二级key：</span><%=data[index+1].key2%></div>
                                <div><span style="color: red;">存储内容：</span></div>
                                <textarea style="width: 100%;height: 120px;" name="info" id="<%=data[index+1].key2%>"   ><%=data[index+1].info%></textarea>
                                <button  class="buttonTableUpdate" type="submit" >更新</button>
                                <a  class="buttonTableLook" onclick = "openDialog('<%=data[index+1].key2%>','<%=data[index+1].info%>')">可视化</a>
                            </form>
                     </td>
                <%}%>
                <% if(data[index+2] != null) {%>
                    <td style="width: 8%;">
                            <form action="/s_player/editSave/<%=token%>/<%=win.uuid%>/<%=data[index+2].key1%>/<%=data[index+2].key2%>" method="POST" onsubmit="return fileSubmit(this)">
                                <div><span style="color: red;">标题：</span><%=data[index+2].desc%></div>
                                <div><span style="color: red;">存储一级key：</span><%=data[index+2].key1%></div>
                                <div><span style="color: red;">存储二级key：</span><%=data[index+2].key2%></div>
                                <div><span style="color: red;">存储内容：</span></div>
                                <textarea style="width: 100%;height: 120px;" name="info" id="<%=data[index+2].key2%>"   ><%=data[index+2].info%></textarea>
                                <button  class="buttonTableUpdate" type="submit" >更新</button>
                                <a  class="buttonTableLook" onclick = "openDialog('<%=data[index+2].key2%>','<%=data[index+2].info%>')">可视化</a>
                            </form>
                     </td>
                <%}%>
            </tr>
            <%}%>

        </table>

</div>

<div id="light_close" class="white_content_close">
    <a href = "javascript:void(0)" onclick = "closeDialog()"><p style="color: red;font-weight: 900">【点 击 这 里 关 闭 窗 口】</p></a>
</div>
<div id="light" class="white_content">
  

</div>



</body>
    
<script>

function fileSubmit(obj){
    if(document.getElementById("addOnclick").value != ""){
        let _id = document.getElementById("addOnclick").value
        document.getElementById(_id).style.height = "120px"
    }
    let items =  obj.info.value
    if (typeof items == 'string') {
        try {
            let obj = JSON.parse(items);
            if(typeof obj == 'object' && obj ){
                return true;
            }else{
                alert("道具列表格式错误!")
                return false;
            }
        } catch(e) {
            alert("道具列表格式错误")
            return false;
        }
    }
}


window.onload = function(){
    let _win =  document.getElementById("win").value
    if(_win){
        let win = JSON.parse(_win)
        document.getElementById("uuid").value = win["uuid"]
    }
}


function openDialog(key2,_info){
    let info = JSON.parse(_info);
    let html = ""
    if (key2 == "mail_mailList_list") {
        html += `
        <table border="0" cellspacing="1" cellpadding="4" bgcolor="#cccccc" class="tabtop13" align="center">
        <tr>
            <td style="width: 8%;">邮件ID</td>
            <td style="width: 8%;">邮件类型</td>
            <td style="width: 8%;">标题</td>
            <td style="width: 8%;">内容</td>
            <td style="width: 8%;">道具列表</td>
            <td style="width: 8%;">发送时间</td>
            <td style="width: 8%;">读取时间</td>
            <td style="width: 8%;">过期时间</td>
        </tr> `
        
        for (const mid in info) {
            html += 
            `<tr>
            <td>${mid}</td>
            <td>${info[mid].type == 2 ? "充值邮件" : "普通邮件"}</td>
            <td>${info[mid].title}</td>
            <td>${info[mid].content}</td>
            <td><textarea style="width: 100%;height: 40px;" >${JSON.stringify(info[mid].items)}</textarea></td>
            <td>${getTime(info[mid].fts)}</td>
            <td>${info[mid].rts == 0 ? "未领取" :getTime(info[mid].rts)}</td>
            <td>${info[mid].ets == 0 ? "永不过期" :getTime(info[mid].ets)}</td>
            </tr> `
        }
       
        html += `</table> <br>
        `
        document.getElementById('light').innerHTML = html
        document.getElementById('light').style.display='block';
        document.getElementById('light_close').style.display='block';
        return
    }

    html += `
        <table border="0" cellspacing="1" cellpadding="4" bgcolor="#cccccc" class="tabtop13" align="center">
        <tr>
            <td style="width: 8%;">key</td>
            <td style="width: 8%;">value</td>
        </tr> `
        
        for (const mid in info) {
            html += 
            `<tr>
            <td>${mid}</td>
            <td><textarea style="width: 100%;height: 40px;" >${typeof info[mid] == "object" ? JSON.stringify(info[mid]) : info[mid]}</textarea></td>
            </tr> `
        }
        html += `</table> <br>
        `
        document.getElementById('light').innerHTML = html
        document.getElementById('light').style.display='block';
        document.getElementById('light_close').style.display='block';
        return


}
function closeDialog(){
    document.getElementById('light').style.display='none';
    document.getElementById('light_close').style.display='none';
}




function getTime(time) {
    var today = new Date(time*1000);
    var year = today.getFullYear(); //年
    var month = today.getMonth() + 1; //月
    var day = today.getDate(); //日

    var hh = today.getHours(); //时
    var mm = today.getMinutes(); //分
    var ss = today.getSeconds(); //秒

    var clock = year + "-";
    if (month < 10) clock += "0";

    clock += month + "-";

    if (day < 10) clock += "0";

    clock += day + " ";

    if (hh < 10) clock += "0";

    clock += hh + ":";
    if (mm < 10) clock += "0";
    clock += mm + ":";

    if (ss < 10) clock += "0";
    clock += ss;

    return clock;
}
</script>

<style>

* {
    margin: 0;
	padding: 0;
    box-sizing: border-box;
}

.left_wrap{
    height: 100%;
    width: 97%;
    background-color: #363a45;
    text-align: center;
    color: #fff;
}
.left_nav{
    width: 100%;
    margin: 10px 5px;
}
.left_nav-list h2{
    position:relative;
    padding: 15px 0;
    background-color: #3889d4;
    font-size: 15px;
}
.left_nav-list h2:hover{
    background-color: RoyalBlue;
    color: #cdcdcd;
}
.left_nav-list h2.on{                    /*设置h2点击后类on属性，点击后h2颜色变化*/
    background-color: RoyalBlue;
}
.left_nav-list i{
    position:absolute;
    right: 10px;
    top: 16px;
    border: 8px solid transparent;
    border-top-color: #fff;
    transform-origin: 1px 7px;   /*设置小三角旋转基点*/
    transition: .8s;    /*旋转过渡时间*/
}
.left_nav-list i.on{               /*设置点击后添加的类on属性（小三角旋转角度）*/
    transform: rotate(90deg);   
}
.left_hide{
    height: 100%;
    overflow: hidden;
    margin-bottom: 5px;
    /* transition: 1s; */
}
.left_hide h5{
    padding: 10px 0;
    background-color: #282c3a;
    border-bottom: 1px solid #42495d;
}
.left_hide h5:hover{
background-color: #03B9FA;
}
/* body 样式 */
body {
    font-family: Arial;
    margin: 0;
}
/* 导航 */
.navbar {
    overflow: hidden;
    background-color: #4f4f4f;
    height:40px;
}
/* 导航栏样式 */
.navbar a {
    float: left;
    display: block;
    color: white;
    text-align: center;
    padding: 14px 20px;
    text-decoration: none;
}
/* 右侧链接*/
.navbar a.right {
    float: right;
}
/* 鼠标移动到链接的颜色 */
.navbar a:hover {
    background-color: rgb(221, 221, 221);
    color:  #ddd;
}
/* 列容器 */
.divleft{
    float:left; 
    width:10%;
    min-height: 100vh;
    background-color: #4f4f4f;
}
.divright{ float:right; width:88%; }
/* 导航 */
.navbarleft {
    overflow: hidden;
    background-color: #4f4f4f;
}
/* 导航栏样式 */
.navbarleft a {
    float: left;
    display: block;
    color: white;
    text-align: center;
    padding: 14px;
    text-decoration: none;
}
/* 鼠标移动到链接的颜色 */
.navbarleft a:hover {
    background-color: #00A2E9;
    color: red;
}
.button {
    background-color: #363a45;
    border: none;
    color: white;
    /* padding: 15px 32px; */
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    /* margin: 4px 2px; */
    cursor: pointer;
    width:97%;
    height:100%;
}

.buttonTable {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
    cursor: pointer;
    width:100%;
    height:40px;
}
.buttonTableUpdate {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
    cursor: pointer;
    width:80%;
    height:40px;
}
.buttonTableLook {
    background-color: rgb(34, 13, 223);
    color: white;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    padding: 0 0 0 0;
    font-size: 12px;
    cursor: pointer;
    width:19%;
    height:30px;
}

/* CSS Document */
.tabtop13 {
	margin-top: 13px;
}
.tabtop13 td{
	background-color:#ffffff;
	height:25px;
	line-height:150%;
}
.biaoti{
	font-family: 微软雅黑;
	font-size: 26px;
	font-weight: bold;
	border-bottom:1px dashed #CCCCCC;
	color: #255e95;
    width:88%;
}


/* 弹窗 */
.white_content_close { 
    display: none; 
    position: fixed; 
    top: 20%; 
    left: 25%; 
    width: 55%; 
    height: 5%; 
    border: 10px solid #b9cfe0;
    background-color: rgb(255, 255, 255); 
    resize: both;
    transform: translateX(25%) translateY(25%)
} 
.white_content { 
    display: none; 
    position: fixed; 
    top: 13%; 
    left: 25%; 
    width: 55%; 
    height: 55%; 
    padding: 20px; 
    border: 10px solid #b9cfe0; 
    background-color: white; 
    z-index:1002; 
    overflow: auto; 
    resize: both;
    transform: translateX(25%) translateY(25%)
} 


</style>
</html>


